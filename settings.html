<!doctype html>
<html lang="ja">
<!-- settings.html -->
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>設定</title>
    <style>
        /* ================== 共通変数 ================== */
        :root {
            --bg1: #2f6f61; /* 背景グリーン */
            --bg2: #2a5f52;
            --ink: #111;
            /* html1 のUIに必要な色たち */
            --panel: rgba(0,0,0,.18); /* カード/セグメント下地 */
            --panel-line: rgba(255,255,255,.6);
            --accent: #fff;
            --brand: #9ec8ff; /* 水色ラベル */
            /* トグル/セグメント（後者の見た目） */
            --switch-on: #2bd06d;
            --switch-off: #e5e5ea;
            --segment-sel: #fff;

            /* 追加: スライダー用の色 */
            --slider-fill: #2a6df6; /* 左側の青 */
            --slider-base: #cfd8dc; /* 右側のグレー */
            --slider-track-h: 6px; /* ← 太さ */
            --slider-thumb: 18px; /* ← つまみの直径 */
        }

        /* ================== ベース ================== */
        * {
            box-sizing: border-box
        }

        html, body {
            height: 100%
        }

        body {
            margin: 0;
            color: var(--ink);
            font-family: system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial;
            -webkit-tap-highlight-color: transparent;
            background: radial-gradient(70rem 40rem at 50% -20%, rgba(255,255,255,.08), transparent 70%), linear-gradient(180deg,var(--bg1),var(--bg2));
            position: relative;
            overflow-x: hidden;
        }

        /* ================== html1 側（フォームカード群） ================== */
        .sheet {
            min-height: 100%;
            padding: 16px 16px 24px;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .card {
            background: var(--panel);
            border: 1px solid var(--panel-line);
            border-radius: 16px;
            padding: 14px;
            backdrop-filter: saturate(120%) blur(2px);
        }

        .label1 {
            background: var(--brand);
            color: #0f2350;
            font-weight: 700;
            border-radius: 8px;
            padding: 10px 12px;
            margin: 6px 0 10px;
        }

        /* セグメント（ランダム/正方向/逆さま、100首/個別指定） */
        .seg {
            display: grid;
            gap: 10px;
            background: rgba(255,255,255,.25);
            border: 1px solid var(--panel-line);
            border-radius: 14px;
            padding: 10px;
        }

            .seg.cols-3 {
                grid-template-columns: repeat(3,1fr)
            }

            .seg.cols-2 {
                grid-template-columns: repeat(2,1fr)
            }

            .seg input {
                display: none
            }

            .seg label {
                display: block;
                border-radius: 12px;
                text-align: center;
                padding: 10px 0;
                font-weight: 700;
                user-select: none;
                cursor: pointer;
            }

            .seg input:checked + span {
                display: block;
                background: var(--accent);
                color: #222;
                border-radius: 12px;
                padding: 10px 0;
                box-shadow: 0 1px 0 rgba(0,0,0,.1), 0 2px 10px rgba(0,0,0,.08) inset;
            }

        /* チェックリスト */
        .group-title {
            margin: 10px 0 6px;
            font-weight: 700
        }

        .checklist {
            list-style: none;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            gap: 14px;
        }

            .checklist label {
                display: flex;
                align-items: center;
                gap: 12px;
                font-size: 1.05rem
            }

            .checklist input[type="checkbox"] {
                inline-size: 22px;
                block-size: 22px;
                accent-color: #10b981;
            }

        /* 個別指定が無効のとき */
        .disabled {
            opacity: .45;
            pointer-events: none
        }

        /* フッターボタン */
        .footer {
            margin-top: auto
        }

        .btn {
            display: block;
            width: 100%;
            padding: 14px 18px;
            border: 0;
            border-radius: 12px;
            background: #ee6b9e;
            color: #fff;
            font-weight: 800;
            font-size: 1.05rem;
            letter-spacing: .05em;
        }

        /* ================== html2 側（ヘッダー/背景透かし/トグル群） ================== */
        /* 透かし文字 */
        .watermark {
            position: fixed;
            inset: 0;
            display: grid;
            place-items: center;
            pointer-events: none;
            user-select: none;
            opacity: .18;
            font-weight: 800;
            font-size: 22vw;
            color: #d7f5e7;
            letter-spacing: .1em;
        }

        /* ヘッダー＆周辺 */
        .wrap {
            position: relative;
            max-width: 560px;
            margin: 0 auto;
            padding: 20px 16px 32px
        }

        .header {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            align-items: center;
            margin-bottom: 6px;
        }

            .header a {
                justify-self: start;
                color: #0a84ff;
                text-decoration: none;
                font-weight: 600;
                padding: 6px 4px;
                font-size: 1.05rem;
            }

            .header h1 {
                margin: 0;
                font-size: 1.2rem;
                font-weight: 800;
                letter-spacing: .08em
            }

        /* セグメント（100/50/25） */
        .segment {
            display: grid;
            grid-template-columns: repeat(3,1fr);
            gap: 0;
            background: var(--panel);
            padding: 6px;
            border-radius: 14px;
            margin: 16px auto 8px;
            width: min(92%,420px);
            backdrop-filter: saturate(120%) blur(2px);
        }

            .segment input {
                display: none
            }

            .segment label {
                position: relative;
                display: block;
                text-align: center;
                cursor: pointer;
                border-radius: 10px;
                padding: 10px 0;
                color: #eee;
                font-weight: 700;
            }

            .segment input:checked + span {
                display: block;
                background: var(--segment-sel);
                color: #1d1d1f;
                border-radius: 10px;
                padding: 10px 0;
                box-shadow: 0 1px 0 rgba(0,0,0,.1), inset 0 2px 10px rgba(0,0,0,.06);
            }

        /* リスト行 */
        .list {
            margin-top: 8px;
            display: flex;
            flex-direction: column;
            gap: 18px
        }

        .row {
            display: grid;
            align-items: center;
            grid-template-columns: 1fr auto;
            column-gap: 14px;
        }

            .row .label {
                color: #0b0b0b;
                font-weight: 700;
                letter-spacing: .02em
            }

        /* iOS風トグル（クリック可） */
        .switch {
            position: relative;
            width: 52px;
            height: 32px
        }

            .switch input {
                position: absolute;
                inset: 0;
                width: 100%;
                height: 100%;
                opacity: 0;
                margin: 0;
                cursor: pointer;
                z-index: 3;
            }

        .track {
            position: absolute;
            inset: 0;
            background: var(--switch-off);
            border-radius: 999px;
            transition: background .2s ease, box-shadow .2s ease;
            box-shadow: inset 0 0 1px rgba(0,0,0,.4);
            z-index: 1;
            pointer-events: none;
        }

        .thumb {
            position: absolute;
            top: 50%;
            left: 3px;
            translate: 0 -50%;
            width: 26px;
            height: 26px;
            border-radius: 50%;
            background: #fff;
            box-shadow: 0 2px 6px rgba(0,0,0,.25);
            transition: left .2s ease;
            z-index: 2;
            pointer-events: none;
        }

        .switch input:checked ~ .track {
            background: var(--switch-on)
        }

        .switch input:checked ~ .thumb {
            left: 23px
        }

        /* スライダー（目標時間） */
        .row.slider {
            grid-template-columns: auto 1fr auto;
            align-items: center
        }

        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: var(--slider-thumb);
            background: var(--slider-base);
            background-position: left center;
            background-size: 100% var(--slider-track-h);
            background-repeat: no-repeat;
            border-radius: 999px;
            outline: none;

        }

            input[type="range"]::-webkit-slider-thumb {
                -webkit-appearance: none;
                appearance: none;
                width: var(--slider-thumb);
                height: var(--slider-thumb);
                border-radius: 50%;
                background: #fff;
                border: 1px solid rgba(0,0,0,.1);
                box-shadow: 0 2px 6px rgba(0,0,0,.25);
                margin-top: 0;

            }

            input[type="range"]::-moz-range-thumb {

                border-radius: 50%;
                background: #fff;
                border: 1px solid rgba(0,0,0,.1);
                box-shadow: 0 2px 6px rgba(0,0,0,.25);
            }

            input[type="range"]::-moz-range-track {
                height: var(--slider-track-h);
                background: transparent;
            }

        .sliderPram {
            width: 64px;
            text-align: right;
            font-weight: 700
        }

        .spacer {
            height: 28px
        }
        .side {
            width: 260px;
            max-width: 30vw;
            background: var(--card);
            border-radius: 16px;
            padding: 16px;
            box-shadow: 0 12px 36px rgba(0,0,0,.35);
            position: sticky;
            top: 16px;
            align-self: start;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .board {
            grid-area: board;
        }

        .side.lists {
            grid-area: lists;
            width: 80%;
            height: 100%;
        }

        .side.controls {
            grid-area: controls;
            width: 80%;
        }

        .lists-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            top: 16px;
            align-self: start;
        }

        .listBox {
            background: var(--card);
            border-radius: 16px;
            padding: 12px;
            box-shadow: 0 12px 36px rgba(0,0,0,.35);
            max-height: 460px;
            overflow: auto;
        }

            .listBox summary {
                font-weight: 700;
                cursor: default;
                list-style: none;
                margin-bottom: 6px;
            }

                .listBox summary::-webkit-details-marker {
                    display: none;
                }

        .list-row {
            cursor: pointer;
        }

            .list-row.selected {
                background: rgba(99,102,241,.18);
                outline: 2px solid #6366f1;
                border-radius: 8px;
            }

    </style>
</head>
<body>


    <div class="wrap">
        <header class="header">
            <a href="./index.html" aria-label="戻る">戻る</a>
            <h1>設定</h1>
            <span></span>
        </header>

        <div class="list" role="group" aria-label="札流しの設定">
            <div class="row">
                <div class="label">札の方向</div>
                <div class="seg cols-3" role="tablist" aria-label="札の方向">
                    <label><input type="radio" name="direction" value="random" checked><span>ランダム</span></label>
                    <label><input type="radio" name="direction" value="normal"><span>正方向</span></label>
                    <label><input type="radio" name="direction" value="reverse"><span>逆さま</span></label>
                </div>

            </div>

            <div class="row">
                <div class="label">決まり字変化を考慮する</div>
                <div class="switch">
                    <input id="changing" type="checkbox" checked>
                    <div class="track" aria-hidden="true"></div>
                    <div class="thumb" aria-hidden="true"></div>
                </div>
            </div>

            <div class="row">
                <div class="label">回答後に自動で次へ進む</div>
                <div class="switch">
                    <input id="autoSend" type="checkbox">
                    <div class="track"></div>
                    <div class="thumb"></div>
                </div>
            </div>

            <div class="row slider">
                <div class="label">待機時間</div>
                <input id="waitRange" type="range" min="1" max="9999" step="1" value="500" aria-label="待機時間（ミリ秒）">
                <div class="sliderPram"><span id="waitValue">500</span>ms</div>
            </div>

            <div class="row slider">
                <div class="label">枚数&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
                <input id="countRange" type="range" min="1" max="100" step="1" value="100" aria-label="枚数（枚）">
                <div class="sliderPram"><span id="countValue">100</span>枚</div>
            </div>

            <div class="row">
                <div class="label">決まり字を限定する(選択されたもののみ使用される)</div>
                <div class="switch">
                    <input id="allOrPart" type="checkbox" checked>
                    <div class="track"></div>
                    <div class="thumb"></div>
                </div>
            </div>


            <div class="row">
                <div class="label">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
                <div class="switch">
                    <input id="sound" type="checkbox" checked>
                    <div class="track"></div>
                    <div class="thumb"></div>
                </div>
            </div>

            <aside class="side lists">
                <div class="lists-grid">

                    <section class="listBox">
                        <details open>
                            <summary>決まり字（グループ）</summary>
                            <div id="listGroup">
                                <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：う</span> <span class="lab"></span> </div>
                                <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：つ</span> <span class="lab"></span> </div>
                                <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：し</span> <span class="lab"></span> </div>
                                <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：も</span> <span class="lab"></span> </div>
                                <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：ゆ</span> <span class="lab"></span> </div>
                                <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：い</span> <span class="lab"></span> </div>
                                <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：いま</span> <span class="lab"></span> </div>
                                <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：ち</span> <span class="lab"></span> </div>
                                <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：ちぎ</span> <span class="lab"></span> </div>
                                <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：ひ</span> <span class="lab"></span> </div>
                                <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：ひと</span> <span class="lab"></span> </div>
                                <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：き</span> <span class="lab"></span> </div>
                                <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：きみ</span> <span class="lab"></span> </div>
                                <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：は</span> <span class="lab"></span> </div>
                                <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：はな</span> <span class="lab"></span> </div>
                                <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：はる</span> <span class="lab"></span> </div>
                                <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：や</span> <span class="lab"></span> </div>
                                <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：やま</span> <span class="lab"></span> </div>
                                <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：よ</span> <span class="lab"></span> </div>
                                <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：よの</span> <span class="lab"></span> </div>
                                <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：か</span> <span class="lab"></span> </div>
                                <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：かぜ</span> <span class="lab"></span> </div>
                                <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：み</span> <span class="lab"></span> </div>
                                <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：みか</span> <span class="lab"></span> </div>
                                <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：た</span> <span class="lab"></span> </div>
                                <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：こ</span> <span class="lab"></span> </div>
                                <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：ここ</span> <span class="lab"></span> </div>
                                <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：お</span> <span class="lab"></span> </div>
                                <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：おお</span> <span class="lab"></span> </div>
                                <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：わ</span> <span class="lab"></span> </div>
                                <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：わが</span> <span class="lab"></span> </div>
                                <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：わす</span> <span class="lab"></span> </div>
                                <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：わた</span> <span class="lab"></span> </div>
                                <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：な</span> <span class="lab"></span> </div>
                                <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：なが</span> <span class="lab"></span> </div>
                                <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：なげ</span> <span class="lab"></span> </div>
                                <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：なに</span> <span class="lab"></span> </div>
                                <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：なにわ</span> <span class="lab"></span> </div>
                                <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：あ</span> <span class="lab"></span> </div>
                                <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：あき</span> <span class="lab"></span> </div>
                                <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：あさ</span> <span class="lab"></span> </div>
                                <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：あさぼ</span> <span class="lab"></span> </div>
                                <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：あま</span> <span class="lab"></span> </div>
                                <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：あら</span> <span class="lab"></span> </div>
                                <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：あり</span> <span class="lab"></span> </div>
                                <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：あわ</span> <span class="lab"></span> </div>
                            </div>
                        </details>
                    </section>

                    <section class="listBox">
                        <details open>
                            <summary>決まり字（個別）</summary>
                            <div id="listIndividual">
                                <div class="list-row unread-stable" title=""> <span><span class="mono">#087</span>：む</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#018</span>：す</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#057</span>：め</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#022</span>：ふ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#070</span>：さ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#081</span>：ほ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#077</span>：せ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#074</span>：うか</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#065</span>：うら</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#023</span>：つき</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#013</span>：つく</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#040</span>：しの</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#037</span>：しら</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#100</span>：もも</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#066</span>：もろ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#071</span>：ゆう</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#046</span>：ゆら</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#061</span>：いに</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#021</span>：いまこ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#063</span>：いまは</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#075</span>：ちぎりお</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#042</span>：ちぎりき</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#017</span>：ちは</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#033</span>：ひさ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#035</span>：ひとは</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#099</span>：ひとも</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#050</span>：きみがためお</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#015</span>：きみがためは</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#091</span>：きり</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#096</span>：はなさ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#009</span>：はなの</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#002</span>：はるす</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#067</span>：はるの</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#047</span>：やえ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#059</span>：やす</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#032</span>：やまが</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#028</span>：やまざ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#093</span>：よのなかは</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#083</span>：よのなかよ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#085</span>：よも</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#062</span>：よを</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#051</span>：かく</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#006</span>：かさ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#098</span>：かぜそ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#048</span>：かぜを</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#049</span>：みかき</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#027</span>：みかの</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#090</span>：みせ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#014</span>：みち</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#094</span>：みよ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#073</span>：たか</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#055</span>：たき</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#004</span>：たご</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#016</span>：たち</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#089</span>：たま</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#034</span>：たれ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#041</span>：こい</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#029</span>：こころあ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#068</span>：こころに</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#097</span>：こぬ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#024</span>：この</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#010</span>：これ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#060</span>：おおえ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#095</span>：おおけ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#044</span>：おおこ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#005</span>：おく</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#026</span>：おぐ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#072</span>：おと</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#082</span>：おも</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#008</span>：わがい</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#092</span>：わがそ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#038</span>：わすら</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#054</span>：わすれ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#076</span>：わたのはらこ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#011</span>：わたのはらや</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#020</span>：わび</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#080</span>：ながか</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#084</span>：ながら</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#053</span>：なげき</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#086</span>：なげけ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#036</span>：なつ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#025</span>：なにし</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#088</span>：なにわえ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#019</span>：なにわが</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#043</span>：あい</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#079</span>：あきか</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#001</span>：あきの</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#052</span>：あけ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#039</span>：あさじ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#031</span>：あさぼらけあ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#064</span>：あさぼらけう</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#003</span>：あし</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#012</span>：あまつ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#007</span>：あまの</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#056</span>：あらざ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#069</span>：あらし</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#030</span>：ありあ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#058</span>：ありま</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#078</span>：あわじ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#045</span>：あわれ</span> <span class="lab"></span> </div>
                            </div>
                        </details>
                    </section>

                </div>
            </aside>
        </div>


    </div>

    <script src="./kimariji-data.js"></script>
    <script>
        // ===== 共有キー =====
        const SETTINGS_KEY = 'karutaSettings.v1';

        // 保存・読込ユーティリティ
        const loadSettings = () => {
            try { return JSON.parse(localStorage.getItem(SETTINGS_KEY)) || {}; }
            catch { return {}; }
        };
        const saveSettings = (obj) => {
            try { localStorage.setItem(SETTINGS_KEY, JSON.stringify(obj)); } catch { }
        };

        // 現在のUIから設定を収集
        function collectSettings() {
            const direction = document.querySelector('input[name="direction"]:checked')?.value || 'random';
            const waitMs = +document.getElementById('waitRange').value || 0;
            const count = +document.getElementById('countRange').value || 100;

            return {
                version: 1,
                direction,
                changing: document.getElementById('changing').checked,
                autoAdvance: document.getElementById('autoSend').checked,
                waitMs,
                count,
                allOrPart: document.getElementById('allOrPart').checked,
                sound: document.getElementById('sound').checked,
                selectedIds: Array.from(selectedIndividuals), // ← 既存の Set から
                updatedAt: Date.now()
            };
        }

        // 設定をUIへ反映（初回表示時）
        function applySettings(s) {
            if (!s) return;

            // ラジオ
            if (s.direction) {
                const r = document.querySelector(`input[name="direction"][value="${s.direction}"]`);
                if (r) r.checked = true;
            }
            // トグル
            if ('changing' in s) document.getElementById('changing').checked = !!s.changing;
            if ('autoAdvance' in s) document.getElementById('autoSend').checked = !!s.autoAdvance;
            if ('allOrPart' in s) document.getElementById('allOrPart').checked = !!s.allOrPart;
            if ('sound' in s) document.getElementById('sound').checked = !!s.sound;

            // スライダ
            if ('waitMs' in s) document.getElementById('waitRange').value = +s.waitMs;
            if ('count' in s) document.getElementById('countRange').value = +s.count;

            // 表示数値と見た目（既存の bindRange/paintrange を活用）
            document.getElementById('waitValue').textContent = document.getElementById('waitRange').value;
            document.getElementById('countValue').textContent = document.getElementById('countRange').value;
            paintRange(document.getElementById('waitRange'));
            paintRange(document.getElementById('countRange'));

            // 個別選択
            if (Array.isArray(s.selectedIds)) {
                selectedIndividuals.clear();
                s.selectedIds.forEach(id => selectedIndividuals.add(+id));
                recomputeUI(); // 既存関数：選択の見た目を更新
            }
        }

        // こまめに保存（連打対策のデバウンス）
        let saveTimer = null;
        function saveSoon() {
            clearTimeout(saveTimer);
            saveTimer = setTimeout(() => saveSettings(collectSettings()), 100);
        }


        // スライダーと設定値の連動
        function paintRange(el) {
            const min = +el.min, max = +el.max, val = +el.value;
            const pct = ((val - min) / (max - min)) * 100;
            el.style.background =
                `linear-gradient(to right,
                  var(--slider-fill) 0%, var(--slider-fill) ${pct}%,
                  var(--slider-base) ${pct}%, var(--slider-base) 100%)`;
        }

        function bindRange(inputEl, outEl) {
            const update = () => { outEl.textContent = inputEl.value; paintRange(inputEl); };
            inputEl.addEventListener('input', update);
            update(); // 初期表示
        }

        bindRange(document.getElementById('waitRange'), document.getElementById('waitValue'));
        bindRange(document.getElementById('countRange'), document.getElementById('countValue'));

        // ----共通データを参照 ------------------
        const kimariji1 = window.KIMARIJI_GROUPS;
        const kimariji2 = window.KIMARIJI_ITEMS;

        const halfRow = 3, ROWS = 6, COLS = 11;
        const TOTAL = ROWS * COLS;
        const MAX_IMAGES = ROWS * COLS;
        const revealedIds = new Set();   // 非表示モードで「見せる」と決めた札IDの集合
        const selectedIndividuals = new Set();

        const groupRowByPrefix = new Map();
        const indivRowById = new Map();

        // ★ 追加：グループ → 個別札ID[] のマップを作成
        const groupMap = new Map();
        kimariji1.forEach(g => {
            const ids = kimariji2
                .filter(k => k.s.startsWith(g.s))
                .map(k => k.id);
            groupMap.set(g.s, ids);
        });

        var cardsList = [];
        var isVisible = true;
        var noneCards = [
            false, false, false, false, false, true, true, false, false, false, false,
            false, false, false, false, true, true, true, false, false, false, false,
            false, false, false, false, true, true, true, false, false, false, false,
            false, false, false, false, true, true, true, false, false, false, false,
            false, false, false, false, true, true, true, false, false, false, false,
            false, false, false, false, true, true, false, false, false, false, false
        ];
        var notShow = [
            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
        ];

        // ★ 新：選択状態から UI と盤面(非表示時)を一括再計算
        function recomputeUI() {
            // まず行の見た目を更新
            indivRowById.forEach((row, id) => {
                row.classList.toggle('selected', selectedIndividuals.has(id));
            });
            groupRowByPrefix.forEach((row, prefix) => {
                const ids = groupMap.get(prefix) || [];
                const allSelected = ids.length > 0 && ids.every(id => selectedIndividuals.has(id));
                row.classList.toggle('selected', allSelected);
            });
        }

        // ▼ スイッチ・ラジオ・スライダの変更で保存
        document.getElementById('changing').addEventListener('change', saveSoon);
        document.getElementById('autoSend').addEventListener('change', saveSoon);
        document.getElementById('allOrPart').addEventListener('change', saveSoon);
        document.getElementById('sound').addEventListener('change', saveSoon);
        document.getElementById('waitRange').addEventListener('input', saveSoon);
        document.getElementById('countRange').addEventListener('input', saveSoon);
        document.querySelectorAll('input[name="direction"]').forEach(r => r.addEventListener('change', saveSoon));

        // ★ 新：グループの選択トグル（常時可、非表示時は盤面も反映）
        document.getElementById('listGroup').addEventListener('click', (e) => {
            const row = e.target.closest('.list-row');
            if (!row) return;
            const m = (row.textContent || '').match(/：(.+?)\s*$/);
            if (!m) return;
            const prefix = m[1].trim();

            const ids = groupMap.get(prefix) || [];
            const allSelected = ids.length > 0 && ids.every(id => selectedIndividuals.has(id));
            if (allSelected) {
                ids.forEach(id => selectedIndividuals.delete(id));
            } else {
                ids.forEach(id => selectedIndividuals.add(id));
            }
            recomputeUI();
            saveSoon();
        });
        // ★ 追加：個別の選択トグル（常時可）
        document.getElementById('listIndividual').addEventListener('click', (e) => {
            const row = e.target.closest('.list-row');
            if (!row) return;
            const m = (row.textContent || '').match(/#(\d+)/);
            if (!m) return;
            const id = +m[1];
            if (selectedIndividuals.has(id)) selectedIndividuals.delete(id);
            else selectedIndividuals.add(id);
            recomputeUI();
            saveSoon();
        });

        // ▼ 「戻る」クリック時にも保存
        document.querySelector('.header a[href="./index.html"]').addEventListener('click', (ev) => {
            saveSettings(collectSettings());
            // 保存は同期で十分速いのでそのまま遷移
        });

        // ▼ 初期表示時に保存済み設定を適用
        (function initSettingsPage() {
            applySettings(loadSettings());
        })();

        // 初期化
        (function init() {
            // ★ 追加：行要素をマップ化
            document.querySelectorAll('#listGroup .list-row').forEach(row => {
                const m = (row.textContent || '').match(/：(.+?)\s*$/);
                if (m) { groupRowByPrefix.set(m[1].trim(), row); }
            });
            document.querySelectorAll('#listIndividual .list-row').forEach(row => {
                const m = (row.textContent || '').match(/#(\d+)/);
                if (m) { indivRowById.set(+m[1], row); }
            });

            //render();
            recomputeUI();
        })();


    </script>
</body>
</html>
