<!doctype html>
<html lang="ja">
<head>
    <meta charset="utf-8" />
    <title>札配置 暗記トレーニング </title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="./memorize-placement.css">
    <style>
        :root {
            /* blank.png の実寸を読み取って上書きします */
            --w: 1px;
            --h: 1px;
            --gap: 1px;
            --bg: #0f172a;
            --card: #111827;
            --ink: #e5e7eb;
        }
        * {
            box-sizing: border-box
        }
        body {
            margin: 0;
            background: radial-gradient(1200px 700px at 50% 220px, rgba(255,255,255,.07), rgba(0,0,0,0) 60%), linear-gradient(180deg,#0b1220,#0f172a 30%,#0b1220);
            color: var(--ink);
            font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 24px;
            position: relative;
        }
        body::before {
            content: "";
            position: fixed;
            inset: 0;
            z-index: -1;
            pointer-events: none;

            background: url('background.png') center/cover no-repeat;
            opacity: 0.36;
            filter: saturate(110%) brightness(105%);
        }
        header {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        button {
            cursor: pointer;
            padding: 8px 12px;
            border: none;
            border-radius: 10px;
            background: #4f46e5;
            color: white;
            font-weight: 600;
        }
        .wrap {
            margin: auto;
            background: var(--card);
            padding: 30px;
            background-color: var(--bg);
            background-image: url('tatami.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;

        }
        .field {
            display: inline-block;
            padding: 8px;
            background-color: var(--bg);
            background-image: url('tatami.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            border: 6px solid #243c1d;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0,0,0,.25);
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(11, var(--w));
            grid-auto-rows: var(--h);
            gap: var(--gap);
            justify-content: center;
            background: transparent;
        }
        .cell {
            width: var(--w);
            height: var(--h);
            background: transparent;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .cell img {
            display: block;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .cell.flip img {
            transform: rotate(180deg);
        }
        .page {
            height: 100vh;
            display: grid;
            grid-template-columns: 1fr minmax(340px,480px);
            grid-template-rows: auto auto;
            grid-template-areas:
                "board lists"
                "board controls";
            gap: 24px;
            align-items: start;
        }
        .side {
            width: 260px;
            max-width: 30vw;
            background: var(--card);
            border-radius: 16px;
            padding: 16px;
            box-shadow: 0 12px 36px rgba(0,0,0,.35);
            position: sticky;
            top: 16px;
            align-self: start;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .board {
            grid-area: board;
        }
        .side.lists {
            grid-area: lists;
            width: 80%;
            height: 100%;
        }
        .side.controls {
            grid-area: controls;
            width: 80%;
        }
        .lists-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            top: 16px;
            align-self: start;
        }
        .listBox {
            background: var(--card);
            border-radius: 16px;
            padding: 12px;
            box-shadow: 0 12px 36px rgba(0,0,0,.35);
            max-height: 460px;
            overflow: auto;
        }
        .listBox summary {
            font-weight: 700;
            cursor: default;
            list-style: none;
            margin-bottom: 6px;
        }
        .listBox summary::-webkit-details-marker {
            display: none;
        }
        .list-row {
            cursor: pointer;
        }
        .list-row.selected {
            background: rgba(99,102,241,.18);
            outline: 2px solid #6366f1;
            border-radius: 8px;
        }
    </style>
</head>
<body>

    <div class="page">
        <section class="board">
            <div class="wrap">
                <div id="grid" class="grid" aria-live="polite"></div>
            </div>
        </section>


        <aside class="side lists">
            <div class="lists-grid">

                <section class="listBox">
                    <details open>
                        <summary>決まり字（グループ）</summary>
                        <div id="listGroup">
                            <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：う</span> <span class="lab"></span> </div>
                            <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：つ</span> <span class="lab"></span> </div>
                            <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：し</span> <span class="lab"></span> </div>
                            <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：も</span> <span class="lab"></span> </div>
                            <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：ゆ</span> <span class="lab"></span> </div>
                            <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：い</span> <span class="lab"></span> </div>
                            <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：いま</span> <span class="lab"></span> </div>
                            <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：ち</span> <span class="lab"></span> </div>
                            <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：ちぎ</span> <span class="lab"></span> </div>
                            <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：ひ</span> <span class="lab"></span> </div>
                            <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：ひと</span> <span class="lab"></span> </div>
                            <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：き</span> <span class="lab"></span> </div>
                            <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：きみ</span> <span class="lab"></span> </div>
                            <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：は</span> <span class="lab"></span> </div>
                            <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：はな</span> <span class="lab"></span> </div>
                            <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：はる</span> <span class="lab"></span> </div>
                            <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：や</span> <span class="lab"></span> </div>
                            <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：やま</span> <span class="lab"></span> </div>
                            <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：よ</span> <span class="lab"></span> </div>
                            <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：よの</span> <span class="lab"></span> </div>
                            <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：か</span> <span class="lab"></span> </div>
                            <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：かぜ</span> <span class="lab"></span> </div>
                            <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：み</span> <span class="lab"></span> </div>
                            <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：みか</span> <span class="lab"></span> </div>
                            <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：た</span> <span class="lab"></span> </div>
                            <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：こ</span> <span class="lab"></span> </div>
                            <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：ここ</span> <span class="lab"></span> </div>
                            <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：お</span> <span class="lab"></span> </div>
                            <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：おお</span> <span class="lab"></span> </div>
                            <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：わ</span> <span class="lab"></span> </div>
                            <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：わが</span> <span class="lab"></span> </div>
                            <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：わす</span> <span class="lab"></span> </div>
                            <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：わた</span> <span class="lab"></span> </div>
                            <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：な</span> <span class="lab"></span> </div>
                            <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：なが</span> <span class="lab"></span> </div>
                            <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：なげ</span> <span class="lab"></span> </div>
                            <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：なに</span> <span class="lab"></span> </div>
                            <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：なにわ</span> <span class="lab"></span> </div>
                            <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：あ</span> <span class="lab"></span> </div>
                            <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：あき</span> <span class="lab"></span> </div>
                            <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：あさ</span> <span class="lab"></span> </div>
                            <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：あさぼ</span> <span class="lab"></span> </div>
                            <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：あま</span> <span class="lab"></span> </div>
                            <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：あら</span> <span class="lab"></span> </div>
                            <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：あり</span> <span class="lab"></span> </div>
                            <div class="list-row unread-stable" title=""> <span><span class="mono"></span>：あわ</span> <span class="lab"></span> </div>
                        </div>
                    </details>
                </section>

                <section class="listBox">
                    <details open>
                        <summary>決まり字（個別）</summary>
                        <div id="listIndividual">
                            <div class="list-row unread-stable" title=""> <span><span class="mono">#087</span>：む</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#018</span>：す</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#057</span>：め</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#022</span>：ふ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#070</span>：さ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#081</span>：ほ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#077</span>：せ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#074</span>：うか</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#065</span>：うら</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#023</span>：つき</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#013</span>：つく</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#040</span>：しの</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#037</span>：しら</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#100</span>：もも</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#066</span>：もろ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#071</span>：ゆう</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#046</span>：ゆら</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#061</span>：いに</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#021</span>：いまこ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#063</span>：いまは</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#075</span>：ちぎりお</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#042</span>：ちぎりき</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#017</span>：ちは</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#033</span>：ひさ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#035</span>：ひとは</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#099</span>：ひとも</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#050</span>：きみがためお</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#015</span>：きみがためは</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#091</span>：きり</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#096</span>：はなさ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#009</span>：はなの</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#002</span>：はるす</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#067</span>：はるの</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#047</span>：やえ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#059</span>：やす</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#032</span>：やまが</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#028</span>：やまざ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#093</span>：よのなかは</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#083</span>：よのなかよ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#085</span>：よも</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#062</span>：よを</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#051</span>：かく</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#006</span>：かさ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#098</span>：かぜそ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#048</span>：かぜを</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#049</span>：みかき</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#027</span>：みかの</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#090</span>：みせ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#014</span>：みち</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#094</span>：みよ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#073</span>：たか</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#055</span>：たき</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#004</span>：たご</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#016</span>：たち</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#089</span>：たま</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#034</span>：たれ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#041</span>：こい</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#029</span>：こころあ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#068</span>：こころに</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#097</span>：こぬ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#024</span>：この</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#010</span>：これ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#060</span>：おおえ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#095</span>：おおけ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#044</span>：おおこ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#005</span>：おく</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#026</span>：おぐ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#072</span>：おと</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#082</span>：おも</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#008</span>：わがい</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#092</span>：わがそ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#038</span>：わすら</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#054</span>：わすれ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#076</span>：わたのはらこ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#011</span>：わたのはらや</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#020</span>：わび</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#080</span>：ながか</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#084</span>：ながら</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#053</span>：なげき</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#086</span>：なげけ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#036</span>：なつ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#025</span>：なにし</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#088</span>：なにわえ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#019</span>：なにわが</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#043</span>：あい</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#079</span>：あきか</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#001</span>：あきの</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#052</span>：あけ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#039</span>：あさじ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#031</span>：あさぼらけあ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#064</span>：あさぼらけう</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#003</span>：あし</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#012</span>：あまつ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#007</span>：あまの</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#056</span>：あらざ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#069</span>：あらし</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#030</span>：ありあ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#058</span>：ありま</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#078</span>：あわじ</span> <span class="lab"></span> </div><div class="list-row unread-stable" title=""> <span><span class="mono">#045</span>：あわれ</span> <span class="lab"></span> </div>
                        </div>
                    </details>
                </section>

            </div>
        </aside>

        <aside class="side controls">
            <button id="shuffleBtn">リセット</button>
            <button id="changeVisible">表示 ⇄ 非表示</button>
            <div class="text">札配置 暗記トレーニング ver1.00</div>
        </aside>

    </div>
    <script src="./memorize-placement.js" defer></script>
    <script>
        const kimariji1 = [
            { id: 108, s: "う" }, { id: 109, s: "つ" }, { id: 110, s: "し" }, { id: 111, s: "も" }, { id: 112, s: "ゆ" },
            { id: 113, s: "い" }, { id: 128, s: "いま" }, { id: 114, s: "ち" }, { id: 129, s: "ちぎ" },
            { id: 115, s: "ひ" }, { id: 129, s: "ひと" }, { id: 116, s: "き" }, { id: 130, s: "きみ" },
            { id: 117, s: "は" }, { id: 131, s: "はな" }, { id: 132, s: "はる" }, { id: 118, s: "や" }, { id: 133, s: "やま" },
            { id: 119, s: "よ" }, { id: 134, s: "よの" }, { id: 120, s: "か" }, { id: 135, s: "かぜ" },
            { id: 121, s: "み" }, { id: 136, s: "みか" }, { id: 122, s: "た" }, { id: 123, s: "こ" }, { id: 137, s: "ここ" },
            { id: 124, s: "お" }, { id: 138, s: "おお" }, { id: 125, s: "わ" }, { id: 139, s: "わが" }, { id: 140, s: "わす" }, { id: 141, s: "わた" },
            { id: 126, s: "な" }, { id: 142, s: "なが" }, { id: 143, s: "なげ" }, { id: 144, s: "なに" }, { id: 145, s: "なにわ" },
            { id: 127, s: "あ" }, { id: 146, s: "あき" }, { id: 147, s: "あさ" }, { id: 148, s: "あさぼ" },
            { id: 149, s: "あま" }, { id: 150, s: "あら" }, { id: 151, s: "あり" }, { id: 152, s: "あわ" }
        ];
        const kimariji2 = [
            { id: 87, s: "む" }, { id: 18, s: "す" }, { id: 57, s: "め" }, { id: 22, s: "ふ" }, { id: 70, s: "さ" }, { id: 81, s: "ほ" }, { id: 77, s: "せ" },
            { id: 74, s: "うか" }, { id: 65, s: "うら" }, { id: 23, s: "つき" }, { id: 13, s: "つく" }, { id: 40, s: "しの" }, { id: 37, s: "しら" }, { id: 100, s: "もも" }, { id: 66, s: "もろ" }, { id: 71, s: "ゆう" }, { id: 46, s: "ゆら" },
            { id: 61, s: "いに" }, { id: 21, s: "いまこ" }, { id: 63, s: "いまは" }, { id: 75, s: "ちぎりお" }, { id: 42, s: "ちぎりき" }, { id: 17, s: "ちは" },
            { id: 33, s: "ひさ" }, { id: 35, s: "ひとは" }, { id: 99, s: "ひとも" }, { id: 50, s: "きみがためお" }, { id: 15, s: "きみがためは" }, { id: 91, s: "きり" },
            { id: 96, s: "はなさ" }, { id: 9, s: "はなの" }, { id: 2, s: "はるす" }, { id: 67, s: "はるの" }, { id: 47, s: "やえ" }, { id: 59, s: "やす" }, { id: 32, s: "やまが" }, { id: 28, s: "やまざ" },
            { id: 93, s: "よのなかは" }, { id: 83, s: "よのなかよ" }, { id: 85, s: "よも" }, { id: 62, s: "よを" }, { id: 51, s: "かく" }, { id: 6, s: "かさ" }, { id: 98, s: "かぜそ" }, { id: 48, s: "かぜを" },
            { id: 49, s: "みかき" }, { id: 27, s: "みかの" }, { id: 90, s: "みせ" }, { id: 14, s: "みち" }, { id: 94, s: "みよ" },
            { id: 73, s: "たか" }, { id: 55, s: "たき" }, { id: 4, s: "たご" }, { id: 16, s: "たち" }, { id: 89, s: "たま" }, { id: 34, s: "たれ" },
            { id: 41, s: "こい" }, { id: 29, s: "こころあ" }, { id: 68, s: "こころに" }, { id: 97, s: "こぬ" }, { id: 24, s: "この" }, { id: 10, s: "これ" },
            { id: 60, s: "おおえ" }, { id: 95, s: "おおけ" }, { id: 44, s: "おおこ" }, { id: 5, s: "おく" }, { id: 26, s: "おぐ" }, { id: 72, s: "おと" }, { id: 82, s: "おも" },
            { id: 8, s: "わがい" }, { id: 92, s: "わがそ" }, { id: 38, s: "わすら" }, { id: 54, s: "わすれ" }, { id: 76, s: "わたのはらこ" }, { id: 11, s: "わたのはらや" }, { id: 20, s: "わび" },
            { id: 80, s: "ながか" }, { id: 84, s: "ながら" }, { id: 53, s: "なげき" }, { id: 86, s: "なげけ" }, { id: 36, s: "なつ" }, { id: 25, s: "なにし" }, { id: 88, s: "なにわえ" }, { id: 19, s: "なにわが" },
            { id: 43, s: "あい" }, { id: 79, s: "あきか" }, { id: 1, s: "あきの" }, { id: 52, s: "あけ" }, { id: 39, s: "あさじ" }, { id: 31, s: "あさぼらけあ" }, { id: 64, s: "あさぼらけう" },
            { id: 3, s: "あし" }, { id: 12, s: "あまつ" }, { id: 7, s: "あまの" }, { id: 56, s: "あらざ" }, { id: 69, s: "あらし" }, { id: 30, s: "ありあ" }, { id: 58, s: "ありま" }, { id: 78, s: "あわじ" }, { id: 45, s: "あわれ" }
        ];

        const halfRow = 3, ROWS = 6, COLS = 11;
        const middle = halfRow * COLS, TOTAL = ROWS * COLS;
        const MAX_IMAGES = 66;
        const grid = document.getElementById('grid');
        const shuffleBtn = document.getElementById('shuffleBtn');
        const isVisibleBtn = document.getElementById('changeVisible');
        const BASE_SCALE = 0.09;    // iPhone XR * 0.055

        const revealedIds = new Set();   // 非表示モードで「見せる」と決めた札IDの集合
        const selectedIndividuals = new Set();

        const groupRowByPrefix = new Map();
        const indivRowById = new Map();

        // ★ 追加：グループ → 個別札ID[] のマップを作成
        const groupMap = new Map();
        kimariji1.forEach(g => {
            const ids = kimariji2
                .filter(k => k.s.startsWith(g.s))
                .map(k => k.id);
            groupMap.set(g.s, ids);
        });

        // blank.png の実寸を読み取り、CSS変数を更新
        function setSizeFromFirst() {
            return new Promise((resolve) => {
                const probe = new Image();
                probe.onload = () => {
                    const w = probe.naturalWidth * BASE_SCALE;
                    const h = probe.naturalHeight * BASE_SCALE;
                    const r = document.documentElement.style;
                    r.setProperty('--w', w + 'px');
                    r.setProperty('--h', h + 'px');
                    resolve({ w, h });
                };
                probe.onerror = () => resolve();
                probe.src = 'cards/blank.png';
            });
        }
        var cardsList = [];
        var isVisible = true;
        var noneCards = [
            false, false, false, false, false, true, true, false, false, false, false,
            false, false, false, false, true, true, true, false, false, false, false,
            false, false, false, false, true, true, true, false, false, false, false,
            false, false, false, false, true, true, true, false, false, false, false,
            false, false, false, false, true, true, true, false, false, false, false,
            false, false, false, false, true, true, false, false, false, false, false
        ];
        var notShow = [
            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
        ];

        // 1..MAX_IMAGES をシャッフルして先頭 TOTAL 件を返す（重複なし）
        function pickNumbers() {
            cardsList = Array.from({ length: MAX_IMAGES }, (_, i) => i + 1);
            for (let i = cardsList.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [cardsList[i], cardsList[j]] = [cardsList[j], cardsList[i]];
            }
            return cardsList.slice(0, TOTAL);
        }

        // 画像を配置
        function render() {
            // ★ 変更：非表示モードでも revealedIds に含まれる札だけは見せる
            const nums = cardsList.map(id => (isVisible || revealedIds.has(id)) ? id : 0);
            const frag = document.createDocumentFragment();
            const appendCell = (i, cssPropertyName) => {
                const cell = document.createElement('div');
                cell.className = cssPropertyName;
                const img = document.createElement('img');
                img.alt = `${nums[i]}.png`;
                if (!noneCards[i]) {
                    img.src = `cards/${nums[i]}.png`;
                    cell.appendChild(img);
                }
                frag.appendChild(cell);
            };
            for (let i = 0; i < middle; i++) appendCell(i, 'cell flip');
            for (let i = middle; i < TOTAL; i++) appendCell(i, 'cell');

            grid.innerHTML = '';
            grid.appendChild(frag);
        }

        // ★ 新：選択状態から UI と盤面(非表示時)を一括再計算
        function recomputeUI() {
            // まず行の見た目を更新
            indivRowById.forEach((row, id) => {
                row.classList.toggle('selected', selectedIndividuals.has(id));
            });
            groupRowByPrefix.forEach((row, prefix) => {
                const ids = groupMap.get(prefix) || [];
                const allSelected = ids.length > 0 && ids.every(id => selectedIndividuals.has(id));
                row.classList.toggle('selected', allSelected);
            });

            // 非表示モード時のみ、選択＝“見せる札”に反映
            revealedIds.clear();
            if (!isVisible) {
                 // none ではないマスに置かれている札だけを対象
                const onBoard = new Set();
                for (let i = 0; i < TOTAL; i++) {
                    if (!noneCards[i]) onBoard.add(cardsList[i]);
                }
                selectedIndividuals.forEach(id => { if (onBoard.has(id)) revealedIds.add(id); });
                render(); // 盤面反映
            }
        }


        // ★ 新：グループの選択トグル（常時可、非表示時は盤面も反映）
        document.getElementById('listGroup').addEventListener('click', (e) => {
            const row = e.target.closest('.list-row');
            if (!row) return;
            const m = (row.textContent || '').match(/：(.+?)\s*$/);
            if (!m) return;
            const prefix = m[1].trim();

            const ids = groupMap.get(prefix) || [];
            const allSelected = ids.length > 0 && ids.every(id => selectedIndividuals.has(id));
            if (allSelected) {
                ids.forEach(id => selectedIndividuals.delete(id));
            } else {
                ids.forEach(id => selectedIndividuals.add(id));
            }
            recomputeUI();
        });
        // ★ 追加：個別の選択トグル（常時可）
        document.getElementById('listIndividual').addEventListener('click', (e) => {
            const row = e.target.closest('.list-row');
            if (!row) return;
            const m = (row.textContent || '').match(/#(\d+)/);
            if (!m) return;
            const id = +m[1];
            if (selectedIndividuals.has(id)) selectedIndividuals.delete(id);
            else selectedIndividuals.add(id);
            recomputeUI();
        });


        // イベント: シャッフル（再抽選して表示モードに戻す）
        shuffleBtn.addEventListener('click', () => {
            cardsList = pickNumbers();
            isVisible = true;
            revealedIds.clear();
            selectedIndividuals.clear();    //シャッフル時に、選択情報も合わせてリセットする。
            render();
            recomputeUI();
        });

        // イベント: 表示 ⇄ 非表示
        isVisibleBtn.addEventListener('click', () => {
            isVisible = !isVisible;
            if (!isVisible) revealedIds.clear();
            render();
            recomputeUI();
        });



        // 初期化
        (async function init() {
            await setSizeFromFirst();
            cardsList = pickNumbers();
            isVisible = true;

            // ★ 追加：行要素をマップ化
            document.querySelectorAll('#listGroup .list-row').forEach(row => {
                const m = (row.textContent || '').match(/：(.+?)\s*$/);
                if (m) { groupRowByPrefix.set(m[1].trim(), row); }
            });
            document.querySelectorAll('#listIndividual .list-row').forEach(row => {
                const m = (row.textContent || '').match(/#(\d+)/);
                if (m) { indivRowById.set(+m[1], row); }
            });

            render();
            recomputeUI();
        })();
    </script>
</body>
</html>
